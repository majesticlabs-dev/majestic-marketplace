# Fix Reporter Documentation Schema
# This schema MUST be validated before writing any documentation file

required_fields:
  module:
    type: string
    description: "Module/area of the project (e.g., 'User Service', 'Authentication', 'API Gateway')"
    examples:
      - "User Service"
      - "Authentication"
      - "API Gateway"
      - "Frontend"

  date:
    type: string
    pattern: '^\d{4}-\d{2}-\d{2}$'
    description: "Date when this problem was solved (YYYY-MM-DD)"

  problem_type:
    type: enum
    values:
      - build_error          # Build, compilation, bundling errors
      - test_failure         # Test failures, flaky tests
      - runtime_error        # Exceptions, crashes during execution
      - performance_issue    # Slow queries, memory issues, N+1 queries
      - database_issue       # Migration, query, schema problems
      - security_issue       # Authentication, authorization, XSS, SQL injection
      - ui_bug               # Frontend, UI component issues
      - integration_issue    # External service, API integration problems
      - logic_error          # Business logic bugs
      - developer_experience # DX issues: workflow, tooling, setup
      - workflow_issue       # Development process, missing steps, unclear practices
      - best_practice        # Documenting patterns and practices to follow
      - documentation_gap    # Missing or inadequate documentation
    description: "Primary category of the problem"

  component:
    type: enum
    values:
      - model                # Data layer, ORM models, entities
      - controller           # Request handlers, route controllers
      - view                 # Templates, UI components, views
      - service              # Business logic services, use cases
      - worker               # Background jobs, async tasks, queues
      - database             # Migrations, schema, raw queries
      - frontend             # JavaScript, CSS, client-side code
      - api                  # API endpoints, REST/GraphQL handlers
      - auth                 # Authentication, authorization, sessions
      - config               # Configuration, environment variables
      - test                 # Test framework, fixtures, mocks
      - cli                  # Command-line tools, scripts
      - documentation        # README, guides, inline docs
      - infrastructure       # CI/CD, deployment, containers
    description: "Project component involved"

  symptoms:
    type: array[string]
    min_items: 1
    max_items: 5
    description: "Observable symptoms (error messages, visual issues, crashes)"
    examples:
      - "N+1 query detected in user listing"
      - "API response returns 500 error"
      - "Form submission fails silently"

  root_cause:
    type: enum
    values:
      - missing_dependency   # Missing import, package, or module
      - missing_eager_load   # Missing eager loading (N+1)
      - missing_index        # Database performance issue
      - wrong_api_usage      # Using deprecated/incorrect API
      - scope_issue          # Incorrect query scope or filtering
      - concurrency_issue    # Race condition, thread safety
      - async_timing         # Async/background job timing
      - memory_leak          # Memory leak or excessive allocation
      - config_error         # Configuration or environment issue
      - logic_error          # Algorithm/business logic bug
      - test_isolation       # Test isolation or fixture issue
      - missing_validation   # Missing input validation
      - missing_permission   # Authorization check missing
      - missing_workflow_step # Skipped or undocumented workflow step
      - inadequate_documentation # Missing or unclear documentation
      - missing_tooling      # Lacking helper scripts or automation
      - incomplete_setup     # Missing seed data, fixtures, or config
      - type_error           # Type mismatch, wrong data type
      - null_reference       # Null/undefined reference error
    description: "Fundamental cause of the problem"

  resolution_type:
    type: enum
    values:
      - code_fix             # Fixed by changing source code
      - migration            # Fixed by database migration
      - config_change        # Fixed by changing configuration
      - test_fix             # Fixed by correcting tests
      - dependency_update    # Fixed by updating dependency
      - environment_setup    # Fixed by environment configuration
      - workflow_improvement # Improved development workflow or process
      - documentation_update # Added or updated documentation
      - tooling_addition     # Added helper script or automation
    description: "Type of fix applied"

  severity:
    type: enum
    values:
      - critical             # Blocks production or development (build fails, data loss)
      - high                 # Impairs core functionality (feature broken, security issue)
      - medium               # Affects specific feature (UI broken, performance impact)
      - low                  # Minor issue or edge case
    description: "Impact severity"

optional_fields:
  framework_version:
    type: string
    description: "Framework version where this was encountered (e.g., 'Rails 7.1.0', 'Next.js 14.0')"

  related_components:
    type: array[string]
    description: "Other components that interact with this issue"

  tags:
    type: array[string]
    max_items: 8
    description: "Searchable keywords (lowercase, hyphen-separated)"
    examples:
      - "n-plus-one"
      - "eager-loading"
      - "test-isolation"
      - "api-integration"

  # Learnings Discovery Fields (for lessons-discoverer integration)
  lesson_type:
    type: enum
    values:
      - antipattern         # "Never do X because Y"
      - gotcha              # "Watch out for X in context Y"
      - pattern             # "When doing X, follow pattern Y"
      - setup               # "Missing setup/config step"
      - workflow            # "Process or workflow improvement"
    description: "Type of lesson for categorization in discovery"

  workflow_phase:
    type: array[enum]
    values:
      - planning            # /blueprint before architecture design
      - debugging           # /debug initialization
      - review              # quality-gate reviewers
      - implementation      # build-task coding phase
    description: "Which workflow phases should see this lesson?"

  tech_stack:
    type: array[string]
    description: "Which stacks does this apply to? (rails, python, react, node, generic)"
    examples:
      - ["rails"]
      - ["python", "fastapi"]
      - ["generic"]
    default: ["generic"]

  impact:
    type: enum
    values:
      - blocks_work         # Critical - prevents progress (severity:critical)
      - major_time_sink     # High impact - wastes hours (severity:high)
      - minor_inconvenience # Low impact - small speed bump (severity:medium/low)
    description: "Impact level for discovery prioritization"

  keywords:
    type: array[string]
    max_items: 10
    description: "Semantic keywords for task matching (e.g., 'authentication', 'oauth', 'token')"
    examples:
      - ["authentication", "oauth", "token"]
      - ["n+1", "eager-loading", "includes"]

validation_rules:
  - "module must be a valid project module name"
  - "date must be in YYYY-MM-DD format"
  - "problem_type must match one of the enum values"
  - "component must match one of the enum values"
  - "symptoms must be specific and observable (not vague)"
  - "root_cause must be the ACTUAL cause, not a symptom"
  - "resolution_type must match one of the enum values"
  - "severity must match one of the enum values"
  - "tags should be lowercase, hyphen-separated"

# Example valid front matter:
# ---
# module: User Service
# date: 2025-11-12
# problem_type: performance_issue
# component: model
# symptoms:
#   - N+1 query when loading user records
#   - API response taking >5 seconds
# root_cause: missing_eager_load
# framework_version: Rails 7.1.2
# resolution_type: code_fix
# severity: high
# tags: [n-plus-one, eager-loading, performance]
# ---
#
# Example DX issue front matter:
# ---
# module: Development Workflow
# date: 2025-11-13
# problem_type: developer_experience
# component: config
# symptoms:
#   - No example data for new feature in development
#   - Seed script doesn't demonstrate new capabilities
# root_cause: incomplete_setup
# resolution_type: tooling_addition
# severity: low
# tags: [seed-data, dx, workflow]
# ---
