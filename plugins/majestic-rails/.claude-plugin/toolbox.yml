# Rails Stack Toolbox Manifest v1.1
# Declares Rails-specific capabilities for generic orchestrators

schema_version: 1
plugin: majestic-rails
tech_stack: rails
priority: 100

build_task:
  executor:
    build_agent: general-purpose
    fix_agent: general-purpose

  coding_styles:
    - majestic-rails:dhh-coder
    - majestic-rails:ruby-coder
    - majestic-rails:minitest-coder

  # Path to design system document (generated by /majestic:ux-brief)
  # If set, build-task loads this as context for UI-related work
  design_system_path: docs/design/design-system.md

  research_hooks:
    # Gem/dependency research
    - id: gem_research
      mode: auto
      agent: majestic-rails:research:gem-research
      triggers:
        any_substring:
          - "Gemfile"
          - "gem "
          - "gem'"
          - "bundle"
          - "rubygems"
          - "dependency"
          - "add gem"
          - "install gem"
          - "upgrade gem"
          - "update gem"

    # Authorization patterns
    - id: auth_patterns
      mode: auto
      agent: majestic-engineer:research:best-practices-researcher
      context: "Focus on Rails authorization patterns: Action Policy, Pundit, CanCanCan"
      triggers:
        any_substring:
          - "authorization"
          - "policy"
          - "permission"
          - "access control"
          - "pundit"
          - "cancan"
          - "action_policy"
          - "authorize"

    # Background job patterns
    - id: background_jobs
      mode: auto
      agent: majestic-engineer:research:best-practices-researcher
      context: "Focus on Rails background job patterns: Solid Queue, Sidekiq, Active Job"
      triggers:
        any_substring:
          - "background"
          - "job"
          - "queue"
          - "async"
          - "worker"
          - "sidekiq"
          - "solid queue"
          - "active job"
          - "perform_later"

    # Real-time/WebSocket patterns
    - id: realtime_patterns
      mode: auto
      agent: majestic-engineer:research:best-practices-researcher
      context: "Focus on Rails real-time patterns: Action Cable, Turbo Streams, AnyCable"
      triggers:
        any_substring:
          - "websocket"
          - "cable"
          - "turbo stream"
          - "live update"
          - "anycable"
          - "broadcast"
          - "real-time"
          - "realtime"

    # Database optimization
    - id: db_optimization
      mode: auto
      agent: majestic-rails:database-optimizer
      context: "Focus on Rails database optimization, query performance, indexing"
      triggers:
        any_substring:
          - "migration"
          - "index"
          - "query"
          - "N+1"
          - "performance"
          - "slow query"
          - "optimize"
          - "database"

    # Stimulus/Hotwire patterns
    - id: stimulus_patterns
      mode: auto
      agent: majestic-engineer:research:best-practices-researcher
      context: "Focus on Stimulus.js controller patterns and Hotwire conventions"
      triggers:
        any_substring:
          - "stimulus"
          - "controller"
          - "hotwire"
          - "turbo"
          - "data-controller"
          - "targets"
          - "values"

  pre_ship_hooks:
    - id: rails_lint
      agent: majestic-rails:lint
      required: false

quality_gate:
  reviewers:
    - majestic-rails:review:pragmatic-rails-reviewer
    - majestic-engineer:qa:security-review
    - majestic-rails:review:performance-reviewer
    - majestic-engineer:review:project-topics-reviewer
